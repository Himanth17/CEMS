<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - EventSphere</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%235b21b6'%3E%3Cpath d='M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-12a4 4 0 1 0 0 8 4 4 0 0 0 0-8z'/%3E%3C/svg%3E">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Futura&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
</head>
<body>
  <nav class="navbar">
    <a href="index.html">EventSphere</a>
    <div class="flex gap-4">
      <a href="student-login.html">Student Portal</a>
      <a href="faculty-login.html">Faculty Portal</a>
      <a href="event-form.html">Plan Your Event</a>
      <button class="theme-toggle">ðŸŒ™</button>
      <button id="logout" class="btn-secondary">Logout</button>
    </div>
  </nav>
  <div id="particles"></div>
  <div class="container py-12">
    <div class="mb-6 animate-card">
      <h1 class="text-2xl">Welcome, <span id="user-info">User</span> (<span id="user-role">Role</span>)</h1>
    </div>
    <div id="bookings-container" class="grid grid-cols-2 gap-4">
      <!-- Bookings will be dynamically inserted here -->
    </div>
    <a href="event-form.html" class="btn-primary mt-6 animate-card">Plan Your Event</a>

    <!-- Club Cards Section -->
    <section class="py-12">
      <h2 class="text-2xl mb-6 text-center">Our Clubs</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="club-card animate-card">
          <h3 class="text-lg">SPORTS CLUB: GAMBOL</h3>
        </div>
        <div class="club-card animate-card">
          <h3 class="text-lg">SHORT FILM CLUB: CLAP IN</h3>
        </div>
        <div class="club-card animate-card">
          <h3 class="text-lg">FITNESS CLUB: ASANA</h3>
        </div>
        <div class="club-card animate-card">
          <h3 class="text-lg">TECHNICAL CLUB: YANTRIKEE</h3>
        </div>
        <div class="club-card animate-card">
          <h3 class="text-lg">EDUCATIONAL CLUB: GDG</h3>
        </div>
      </div>
    </section>

    <!-- Previous Event Highlights Section -->
    <section class="py-12">
      <h2 class="text-2xl mb-6 text-center">Previous Event Highlights</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="highlight-card animate-card">
          <h3 class="text-lg">Tech Symposium 2024</h3>
          <p>Placeholder for event media (awaiting Google Drive link).</p>
          <a href="https://drive.google.com" target="_blank" class="btn-primary mt-4">View Highlights</a>
        </div>
        <div class="highlight-card animate-card">
          <h3 class="text-lg">Cultural Fest 2024</h3>
          <p>Placeholder for event media (awaiting Google Drive link).</p>
          <a href="https://drive.google.com" target="_blank" class="btn-primary mt-4">View Highlights</a>
        </div>
        <div class="highlight-card animate-card">
          <h3 class="text-lg">Sports Day 2024</h3>
          <p>Placeholder for event media (awaiting Google Drive link).</p>
          <a href="https://drive.google.com" target="_blank" class="btn-primary mt-4">View Highlights</a>
        </div>
      </div>
    </section>
  </div>

  <footer>
    <!-- About -->
    <div style="display: inline-block; position: relative;">
      <a class="footer-link">About</a>
      <div class="tooltip-box">
        <p><strong>IFHE (ICFAI FOUNDATION FOR HIGHER EDUCATION)</strong></p>
        <p>The Institute of Chartered Financial Analysts of India (ICFAI) was established in 1984 as a non-profit educational society in Hyderabad, Telangana, India. The institution has been offering education to students across India through its various programs in the field of higher education. The institution was founded by N. J. Yasaswy, Besant C. Raj and Dr. Prasanna Chandra, the Director of Centre for Financial Management. Donthanpalle, Telangana 501203.</p>
      </div>
    </div>
  
    <!-- Contact -->
    <div style="display: inline-block; position: relative;">
      <a class="footer-link">Contact</a>
      <div class="tooltip-box text-center">
        <!-- Replace the src below with your Google Drive link (after confirming sharing settings) or a local image path -->
        <img src="images\himanth.jpg" alt="Mendu Himanth" class="profile-photo mb-2">        <p><strong>Name:</strong> Mendu Himanth</p>
        <p><strong>Contact Number:</strong> 8374607486</p>
        <p><strong>Email:</strong> menduhimanth22@ifheindia.org</p>
      </div>
    </div>
  </footer>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
    import { getAuth, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBYEWxN1v0qeBLzuWLRCuKgiviuSP37jPI",
      authDomain: "cems-6ff22.firebaseapp.com",
      projectId: "cems-6ff22",
      storageBucket: "cems-6ff22.firebasestorage.app",
      messagingSenderId: "305415477433",
      appId: "1:305415477433:web:e3ae59ca98930116e36368",
      measurementId: "G-XE9WSDWLKY"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Check auth state and display user info
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const userData = JSON.parse(localStorage.getItem('user') || '{}');
        document.getElementById('user-info').textContent = userData.email || user.email || 'User';
        document.getElementById('user-role').textContent = userData.role || 'Unknown';
        
        // Fetch and display bookings
        fetchBookings(user.uid);
      } else {
        window.location.href = 'student-login.html';
      }
    });

    // Fetch bookings from Firestore
    async function fetchBookings(userId) {
      try {
        const bookingsContainer = document.getElementById('bookings-container');
        bookingsContainer.innerHTML = ''; // Clear existing content
        
        const q = query(collection(db, 'bookings'), where('userId', '==', userId), where('status', '==', 'confirmed'));
        const querySnapshot = await getDocs(q);
        
        if (querySnapshot.empty) {
          bookingsContainer.innerHTML = '<p class="text-center">No confirmed bookings found.</p>';
          return;
        }
        
        querySnapshot.forEach((doc) => {
          const booking = doc.data();
          const bookingCard = document.createElement('div');
          bookingCard.className = 'event-card animate-card';
          bookingCard.innerHTML = `
            <h2 class="text-xl">${booking.name}</h2>
            <p>Chief Guest: ${booking.chief_guest}</p>
            <p>Date: ${booking.date}</p>
            <p>Time: ${booking.time}</p>
            <p>Venue: ${booking.venue}</p>
            <p>Club: ${booking.club}</p>
            <p>Audience Limit: ${booking.audience_limit}</p>
          `;
          bookingsContainer.appendChild(bookingCard);
        });
      } catch (error) {
        console.error('Error fetching bookings:', error);
        document.getElementById('bookings-container').innerHTML = '<p class="text-center text-red-400">Error loading bookings.</p>';
      }
    }

    // Logout
    document.getElementById('logout').addEventListener('click', async () => {
      try {
        await signOut(auth);
        localStorage.removeItem('user');
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Logout error:', error);
      }
    });
  </script>
  <script src="scripts.js"></script>
</body>
</html>